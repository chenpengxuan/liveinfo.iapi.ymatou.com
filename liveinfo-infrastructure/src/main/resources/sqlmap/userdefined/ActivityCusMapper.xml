<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.ymatou.liveinfo.infrastructure.db.cusmapper.ActivityCusMapper" >
  <resultMap id="searchActivity_ResultMap" type="com.ymatou.liveinfo.infrastructure.db.model.ActivityPo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Apr 17 15:29:22 CST 2017.
    -->
    <id column="iActivityId" property="activityId" jdbcType="INTEGER" />
    <result column="iActivityTemplateId" property="activityTemplateId" jdbcType="INTEGER" />
    <result column="sCode" property="code" jdbcType="VARCHAR" />
    <result column="sName" property="name" jdbcType="VARCHAR" />
    <result column="dBeginTime" property="beginTime" jdbcType="TIMESTAMP" />
    <result column="dEndTime" property="endTime" jdbcType="TIMESTAMP" />
    <result column="sTitlePrefix" property="titlePrefix" jdbcType="VARCHAR" />
    <result column="iAction" property="action" jdbcType="INTEGER" />
    <result column="iAdminId" property="adminId" jdbcType="INTEGER" />
    <result column="dAddTime" property="addTime" jdbcType="TIMESTAMP" />
    <result column="iSellerId" property="sellerId" jdbcType="INTEGER" />
    <result column="sPosition" property="position" jdbcType="VARCHAR" />
    <result column="fDefaultFeeRate" property="defaultFeeRate" jdbcType="DECIMAL" />
    <result column="sSeoTitle" property="seoTitle" jdbcType="VARCHAR" />
    <result column="sSeoKeyword" property="seoKeyword" jdbcType="VARCHAR" />
    <result column="sSeoDescription" property="seoDescription" jdbcType="VARCHAR" />
    <result column="sMasterPage" property="masterPage" jdbcType="VARCHAR" />
    <result column="sPageUrl" property="pageUrl" jdbcType="VARCHAR" />
    <result column="sContent" property="content" jdbcType="VARCHAR" />
    <result column="sPicUrl" property="picUrl" jdbcType="VARCHAR" />
    <result column="dApplyDeadline" property="applyDeadline" jdbcType="TIMESTAMP" />
    <result column="iAppliedSpuLimit" property="appliedSpuLimit" jdbcType="INTEGER" />
    <result column="iAppliedSellerType" property="appliedSellerType" jdbcType="INTEGER" />
    <result column="iStockLimit" property="stockLimit" jdbcType="INTEGER" />
    <result column="sSellerName" property="sellerName" jdbcType="VARCHAR" />
    <result column="sOffLineReasons" property="offLineReasons" jdbcType="VARCHAR" />
    <result column="iSort" property="sort" jdbcType="INTEGER" />
    <result column="iMarketId" property="marketId" jdbcType="INTEGER" />
    <result column="sBrands" property="brands" jdbcType="VARCHAR" />
    <result column="iCountryId" property="countryId" jdbcType="INTEGER" />
    <result column="bIsReplay" property="isReplay" jdbcType="BIT" />
    <result column="iOriginalActivityId" property="originalActivityId" jdbcType="INTEGER" />
    <result column="iCreateReplayTimes" property="createReplayTimes" jdbcType="INTEGER" />
    <result column="iLiveActivityId" property="liveActivityId" jdbcType="INTEGER" />
    <result column="iDeliveryType" property="deliveryType" jdbcType="INTEGER" />
    <result column="iVipPushStatus" property="vipPushStatus" jdbcType="INTEGER" />
    <result column="dLastSortUpdateTime" property="lastSortUpdateTime" jdbcType="TIMESTAMP" />
    <result column="sDetailAddress" property="detailAddress" jdbcType="VARCHAR" />
    <result column="bIsFromPC" property="isFromPC" jdbcType="BIT" />
    <result column="bAppConfirmed" property="appConfirmed" jdbcType="BIT" />
    <result column="sTitle" property="title" jdbcType="VARCHAR" />
    <result column="sVideoCover" property="videoCover" jdbcType="VARCHAR" />
    <result column="sVideoUrl" property="videoUrl" jdbcType="VARCHAR" />
    <result column="sLatlng" property="latlng" jdbcType="VARCHAR" />
  </resultMap>

  <resultMap id="IntegerResultMap" type="java.lang.Integer" ></resultMap>

  <select id="searchActivity" parameterType="com.ymatou.liveinfo.facade.model.SearchActivityReq" resultMap="IntegerResultMap, searchActivity_ResultMap">
    select count(*) as recordCount from ymt_activity
    <include refid="where_searchActivity"></include>

    select * from ymt_activity
    <include refid="where_searchActivity"></include>
    <choose>
      <when test="sortField != null and sortField != ''">
        order by ${sortField} ${sortType}
      </when>
      <otherwise>
        ORDER BY iSort desc ,dBeginTime  desc
      </otherwise>
    </choose>
    offset ${(pageIndex-1) * pageSize} rows fetch next ${pageSize} rows only
  </select>

  <sql id="where_searchActivity">
    WHERE
    <![CDATA[iAction <> -1 and dBeginTime < dEndTime]]>
    <if test="activityId > 0">
      and iActivityId = #{activityId, jdbcType=INTEGER}
    </if>
    <if test="exceptSellerIds != null and exceptSellerIds.size() > 0">
      and iSellerId not in
      <foreach item="item" index="index" collection="exceptSellerIds" open="(" separator="," close=")">
        #{item, jdbcType=INTEGER}
      </foreach>
    </if>
    <if test="activityName != null and activityName != ''">
      and sName LIKE '%${activityName}%'
    </if>
    <if test="activityContent != null and activityContent != ''">
      and sContent LIKE '%${activityContent}%'
    </if>
    <if test="addTimeBegin != null">
      and dAddTime >= #{addTimeBegin, jdbcType=TIMESTAMP}
    </if>
    <if test="addTimeEnd != null">
      <![CDATA[and dAddTime <= #{addTimeEnd, jdbcType=TIMESTAMP}]]>
    </if>
    <choose>
      <when test="activityState  == 0">
        <![CDATA[and bAppConfirmed = 1 and dBeginTime <= getdate() and dEndTime > getdate()]]>
      </when>
      <when test="activityState  == -1">
        <![CDATA[and bAppConfirmed = 1 and  dBeginTime >= getdate() ]]>
      </when>
      <when test="activityState  == 1">
        <![CDATA[and ((bAppConfirmed = 1 and  dEndTime < getdate()) or (bAppConfirmed = 0 and  dEndTime < #{willEndTime, jdbcType=TIMESTAMP})) ]]>
      </when>
      <when test="activityState  == 2">
        <![CDATA[and bAppConfirmed = 0 and  dEndTime > #{willEndTime, jdbcType=TIMESTAMP}  ]]>
      </when>
    </choose>
    <if test="startTime != null">
      and dBeginTime >= #{startTime, jdbcType=TIMESTAMP}
    </if>
    <if test="endTime != null">
      <![CDATA[and dEndTime <= #{endTime, jdbcType=TIMESTAMP}]]>
    </if>
    <if test="recommand == true">
      and iSort > 0
    </if>
    <if test="sellerName != null and sellerName != ''">
      and sSellerName like '%${sellerName}%'
    </if>
    <if test="sellerId != null and sellerId > 0">
      and iSellerId = #{sellerId, jdbcType=INTEGER}
    </if>
    <if test="countryId > -1">
      and iCountryId = #{countryId, jdbcType=INTEGER}
    </if>
    <if test="countryIds != null and countryIds.size() > 0">
      and iCountryId IN
      <foreach item="item" index="index" collection="countryIds" open="(" separator="," close=")">
        #{item, jdbcType=INTEGER}
      </foreach>
    </if>
    <if test="isInActivity > -1">
      <if test="isInActivity == 1">
        and iLiveActivityId > 0
      </if>
      <if test="isInActivity != 1">
        <![CDATA[and iLiveActivityId <= 0]]>
      </if>
    </if>
    <if test="isLive == 1">
      and bIsReplay = 1
    </if>
    <if test="isLive == 0">
      and bIsReplay = 0
    </if>
    <!--
    <if test="activityCategory > 0">
      and iCatagoryId = #{activityCategory, jdbcType=INTEGER}
    </if>-->
  </sql>

</mapper>












































